[tox]
envlist =
    py311
    py312
    py313
    py314
    lint
    typecheck
    docs
isolated_build = true
requires =
    tox>=4.11
    tox-uv>=1.0

[testenv]
description = Run tests with pytest
deps =
    pytest>=7.0.0
    pytest-cov>=4.1.0
    pytest-bdd>=7.0.0
    pytest-test-categories>=1.0.0
    pytest-xdist>=3.5.0
    coverage[toml]>=7.0.0
commands =
    pytest {posargs:tests/small tests/medium --cov=pytest_gremlins --cov-report=term-missing}

[testenv:small]
description = Run only small (unit) tests
commands =
    pytest tests/small -m small {posargs}

[testenv:medium]
description = Run small and medium tests
commands =
    pytest tests/small tests/medium -m "small or medium" {posargs}

[testenv:large]
description = Run all tests including large (e2e)
commands =
    pytest {posargs:--cov=pytest_gremlins --cov-report=term-missing}

[testenv:lint]
description = Run linting with ruff
skip_install = true
deps =
    ruff>=0.1.6
commands =
    ruff check src tests
    ruff format --check src tests

[testenv:typecheck]
description = Run type checking with mypy
deps =
    mypy>=1.7.0
    pytest>=7.0.0
commands =
    mypy src/pytest_gremlins

[testenv:docs]
description = Build documentation
deps =
    mkdocs>=1.5.0
    mkdocs-material>=9.0.0
    mkdocstrings[python]>=0.24.0
commands =
    mkdocs build --strict

[testenv:docs-serve]
description = Serve documentation locally
deps =
    mkdocs>=1.5.0
    mkdocs-material>=9.0.0
    mkdocstrings[python]>=0.24.0
commands =
    mkdocs serve

[testenv:security]
description = Run security audit
skip_install = true
deps =
    pip-audit>=2.6.0
commands =
    pip-audit

[testenv:doctest]
description = Run doctests
commands =
    pytest --doctest-modules src/pytest_gremlins {posargs}
